

/////////////////////////////////////////////////////////////////////////////////////////
// СопоставлениеНоменклатурыКонтрагентовПереопределяемый:
// механизм сопоставления номенклатуры контрагентов с номенклатурой информационной базы.
//
/////////////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

#Область РаботаСоСправочникомНоменклатураКонтрагентов

// Обработчик события "ПриСозданииНаСервере" формы выбора справочника НоменклатураКонтрагентов.
//
// Параметры:
//  Форма                - ФормаКлиентскогоПриложения - форма, из обработчика события которой происходит вызов процедуры.
//  Отказ                - Булево                     - признак отказа от создания формы.
//  СтандартнаяОбработка - Булево                     - признак выполнения стандартной (системной) обработки события.
//
Процедура ПриСозданииНаСервере_ФормаВыбораНоменклатурыКонтрагентов(Форма, Отказ, СтандартнаяОбработка) Экспорт
	
КонецПроцедуры

// Обработчик события "ПриСозданииНаСервере" формы списка справочника НоменклатураКонтрагентов.
//
// Параметры:
//  Форма                - ФормаКлиентскогоПриложения - форма, из обработчика события которой происходит вызов процедуры.
//  Отказ                - Булево                     - признак отказа от создания формы.
//  СтандартнаяОбработка - Булево                     - признак выполнения стандартной (системной) обработки события.
//
Процедура ПриСозданииНаСервере_ФормаСпискаНоменклатурыКонтрагентов(Форма, Отказ, СтандартнаяОбработка) Экспорт
	
КонецПроцедуры

// Обработчик события "ПриСозданииНаСервере" формы группы справочника НоменклатураКонтрагентов.
//
// Параметры:
//  Форма                - ФормаКлиентскогоПриложения - форма, из обработчика события которой происходит вызов процедуры.
//  Отказ                - Булево                     - признак отказа от создания формы.
//  СтандартнаяОбработка - Булево                     - признак выполнения стандартной (системной) обработки события.
//
Процедура ПриСозданииНаСервере_ФормаГруппыНоменклатурыКонтрагентов(Форма, Отказ, СтандартнаяОбработка) Экспорт

КонецПроцедуры

// Обработчик события "ПриСозданииНаСервере" формы элемента справочника НоменклатураКонтрагентов.
//
// Параметры:
//  Форма                - ФормаКлиентскогоПриложения - форма, из обработчика события которой происходит вызов процедуры.
//  Отказ                - Булево                     - признак отказа от создания формы.
//  СтандартнаяОбработка - Булево                     - признак выполнения стандартной (системной) обработки события.
//
Процедура ПриСозданииНаСервере_ФормаЭлементаНоменклатурыКонтрагентов(Форма, Отказ, СтандартнаяОбработка) Экспорт

КонецПроцедуры

// Обработчик события "ПриЧтенииНаСервере" формы элемента справочника НоменклатураКонтрагентов.
//
// Параметры:
//  Форма         - ФормаКлиентскогоПриложения                - форма, из обработчика события которой происходит вызов процедуры.
//  ТекущийОбъект - СправочникОбъект.НоменклатураКонтрагентов - объект номенклатуры контрагента.
//
Процедура ПриЧтенииНаСервере_ФормаЭлементаНоменклатурыКонтрагентов(Форма, ТекущийОбъект) Экспорт
	
КонецПроцедуры

// Обработчик события "ПередЗаписьюНаСервере" формы элемента справочника НоменклатураКонтрагентов.
//
// Параметры:
//  Форма           - ФормаКлиентскогоПриложения - форма, из обработчика события которой происходит вызов процедуры.
//  Отказ           - Булево                     - признак отказа от создания формы.
//  ТекущийОбъект   - СправочникОбъект.НоменклатураКонтрагентов - объект номенклатуры контрагента.
//  ПараметрыЗаписи - Структура                                 - структура параметров записи.
//
Процедура ПередЗаписьюНаСервере_ФормаЭлементаНоменклатурыКонтрагентов(Форма, Отказ, ТекущийОбъект, ПараметрыЗаписи) Экспорт
	
КонецПроцедуры

// Обработчик события "ПослеЗаписиНаСервере" формы элемента справочника НоменклатураКонтрагентов.
//
// Параметры:
//  Форма           - ФормаКлиентскогоПриложения                - форма, из обработчика события которой происходит вызов процедуры.
//  ТекущийОбъект   - СправочникОбъект.НоменклатураКонтрагентов - объект номенклатуры контрагента.
//  ПараметрыЗаписи - Структура                                 - структура параметров записи.
//
Процедура ПослеЗаписиНаСервере_ФормаЭлементаНоменклатурыКонтрагентов(Форма, ТекущийОбъект, ПараметрыЗаписи) Экспорт

КонецПроцедуры

// Обработчик события при изменении поля сопоставления номенклатуры в справочнике НоменклатураКонтрагентов.
// Необходимо проверить корректность заполнения характеристики и упаковки при изменении номенклатуры контрагента.
//
// Параметры:
//  Форма               - ФормаКлиентскогоПриложения - форма, из обработчика события которой происходит вызов процедуры.
//  ДанныеСопоставления - Структура                  - содержит данные:
//   * Номенклатура                - ОпределяемыйТип.НоменклатураБЭД               - ссылка номенклатуры ИБ.
//   * Характеристика              - ОпределяемыйТип.ХарактеристикаНоменклатурыБЭД - ссылка характеристики ИБ.
//   * Упаковка                    - ОпределяемыйТип.УпаковкаНоменклатурыБЭД       - ссылка упаковка ИБ.
//   * ИспользоватьХарактеристики  - Булево - признак использования характеристик номенклатуры ИБ.
//   * ЕдиницаИзмеренияПоУмолчанию - ОпределяемыйТип.УпаковкаНоменклатурыБЭД       - ссылка базовой единицы измерения номенклатуры ИБ,
//                                                                                   которую необходимо отобразить пользователю в подсказке.
//
Процедура ПриИзмененииНоменклатурыСопоставления_НоменклатураКонтрагентов(Форма, ДанныеСопоставления) Экспорт
	
КонецПроцедуры

// Обработчик события "ОбработкаПолученияДанныхВыбора" менеджера объекта справочника НоменклатураКонтрагентов.
//
// Параметры:
//  ДанныеВыбора         - СписокЗначений - список номенклатуры контрагентов для вывода пользователю для выбора.
//  Параметры            - Структура      - содержит параметры выбора.
//  СтандартнаяОбработка - Булево         - признак стандартной обработки события.
//
Процедура ОбработкаПолученияДанныхВыбора_НоменклатураКонтрагентов(ДанныеВыбора, Параметры, СтандартнаяОбработка) Экспорт
	
КонецПроцедуры

// Переопределяет текст запроса динамического списка для формы выбора справочника НоменклатураКонтрагентов.
// По умолчанию доступны параметры:
//  ПустаяНоменклатура  - ОпределяемыйТип.НоменклатураБЭД               - ссылка номенклатуры.
//  НоменклатураОтбор   - ОпределяемыйТип.НоменклатураБЭД               - ссылка номенклатуры.
//  ХарактеристикаОтбор - ОпределяемыйТип.ХарактеристикаНоменклатурыБЭД - ссылка характеристики номенклатуры.
//  УпаковкаОтбор       - ОпределяемыйТип.УпаковкаНоменклатурыБЭД       - упаковка/единица измерения. Если в форму выбора номенклатуры контрагента
//                                                                        передавалась пустая упаковка/единица измерения - она будет перезаполнена единицей
//                                                                        хранения номенклатуры, если номенклатура была передана в параметрах.
// При необходимости дополнительные параметры можно описать в методе УстановитьПараметрыДинамическогоСписка_ФормаВыбораНоменклатурыКонтрагентов.
//
// Параметры:
//  ТекстЗапроса - Строка - текст запроса.
//
Процедура ТекстЗапросаДинамическогоСписка_ФормаВыбораНоменклатурыКонтрагента(ТекстЗапроса) Экспорт

КонецПроцедуры

// Переопределяет параметры динамического списка для формы выбора справочника НоменклатураКонтрагентов.
//
// Параметры:
//  Параметры - Структура          - параметры формы выбора.
//  Список    - ДинамическийСписок - список выбора справочника номенклатура контрагентов.
//
Процедура УстановитьПараметрыДинамическогоСписка_ФормаВыбораНоменклатурыКонтрагентов(Параметры, Список) Экспорт
	
КонецПроцедуры

// Переопределяет запрос списка выбора номенклатуры контрагента.
// Необходимо вернуть в запросе поле "Ссылка" - ссылки на номенклатуру контрагента.
// В запросе доступно значение параметров: 
//  Владелец       - ОпределяемыйТип.ВладелецНоменклатурыБЭД       - владелец, для которого необходимо сформировать список выбора.
//  Номенклатура   - ОпределяемыйТип.НоменклатураБЭД               - номенклатура предприятия для фильтрации номенклатуры контрагента.
//  Характеристика - ОпределяемыйТип.ХарактеристикаНоменклатурыБЭД - характеристика номенклатуры предприятия для фильтрации номенклатуры контрагента.
//  Упаковка       - ОпределяемыйТип.УпаковкаНоменклатурыБЭД       - упаковка номенклатуры предприятия для фильтрации номенклатуры контрагента.
//
// Параметры:
//  Запрос - Запрос - запрос списка выбора номенклатуры контрагента.
//
Процедура ТекстЗапросаСпискаВыбораНоменклатурыКонтрагента(Запрос) Экспорт
	
КонецПроцедуры

#КонецОбласти

#Область РаботаСЕдиницамиИзмерения

// Определяет свойства переданной упаковки или единицы измерения по номенклатуре информационной базы.
// Требуется заполнить свойства передаваемой упаковки по номенклатуре в параметре СвойстваУпаковки.
//
// Параметры:
//  Упаковка         - ОпределяемыйТип.УпаковкаНоменклатурыБЭД - упаковка или единица измерения номенклатуры.
//  Номенклатура     - ОпределяемыйТип.НоменклатураБЭД         - номенклатура поиска базовой единицы измерения.
//  СвойстваУпаковки - Структура из см. СопоставлениеНоменклатурыКонтрагентовКлиентСервер.НовыеСвойстваУпаковки - свойства упаковки.
//
Процедура ПриОпределенииСвойствУпаковкиЕдиницыИзмеренияНоменклатуры(Знач Упаковка, Знач Номенклатура, СвойстваУпаковки) Экспорт
	
КонецПроцедуры

// Выполняет поиск наименования единицы измерения по коду ОКЕИ в классификаторе.
// Требуется вернуть наименование единицы измерения или пустую строку.
// Необходимо учесть, что базовая единица измерения может быть упаковкой.
// В таком случае необходимо изменять передаваемый код ОКЕИ.
// Например: т (тонна) будет упаковкой для кг (килограмм).
// Рекомендуется, если не нашли единицу измерения в справочнике по коду ОКЕИ,
// но она есть в классификаторе - загружать в базу ед. измерения из классификатора.
//
// Параметры:
//  КодОКЕИЕдиницыИзмерения      - Строка - код по ОКЕИ единицы измерения.
//  НаименованиеЕдиницыИзмерения - Строка - наименование единицы измерения найденное по коду ОКЕИ.
//
Процедура НайтиНаименованиеЕдиницыИзмеренияПоКодуОКЕИ(КодОКЕИЕдиницыИзмерения, НаименованиеЕдиницыИзмерения) Экспорт
	
КонецПроцедуры

// Возвращает признак является ли владельцем упаковки номенклатура.
// Необходимо переопределять в случае, когда в базе могут использоваться упаковки.
// Требуется проверить упаковку на владельца и определить является ли владельцем номенклатура.
//
// Параметры:
//  Упаковка                     - ОпределяемыйТип.УпаковкаНоменклатурыБЭД - ссылка упаковки единицы измерения.
//  ВладелецУпаковкиНоменклатура - Булево                                  - признак того, что владельцем упаковки является номенклатура.
//
Процедура ВладелецУпаковкиЕдиницыИзмеренияНоменклатура(Знач Упаковка, ВладелецУпаковкиНоменклатура) Экспорт
	
КонецПроцедуры

// Возвращает базовую единицу измерения по номенклатуре.
//
// Параметры:
//  Номенклатура     - ОпределяемыйТип.НоменклатураБЭД          - ссылка номенклатуры.
//  ЕдиницаИзмерения - ОпределяемыйТип.УпаковкаНоменклатурыБЭД - ссылка на базовую единицу измерения номенклатуры.
//
Процедура БазоваяЕдиницаИзмеренияНоменклатуры(Знач Номенклатура, ЕдиницаИзмерения) Экспорт
	
КонецПроцедуры

#КонецОбласти

#Область СопоставлениеНоменклатурыВДокументах

// Переопределяет текст запроса поиска не сопоставленной номенклатуры контрагентов по номенклатуре информационной базы.
// Необходимо вернуть временную таблицу Товары с колонками:
//  Номенклатура            - ОпределяемыйТип.НоменклатураБЭД               - ссылка номенклатуры.
//  Характеристика          - ОпределяемыйТип.ХарактеристикаНоменклатурыБЭД - ссылка характеристики.
//  Упаковка                - ОпределяемыйТип.УпаковкаНоменклатурыБЭД       - ссылка упаковки/единицы измерения.
//  НоменклатураКонтрагента - СправочникСсылка.НоменклатураКонтрагентов     - ссылка номенклатуры контрагента.
//
// Требуется переопределять, если в таблице товаров колонки называются по-другому или требуется подменить значение полей.
// При установленном признаке "ТаблицаТоваровПоУмолчанию = Истина" используется стандартная таблица товаров,
// если имеется подмена значений полей, необходимо их выполнять.
// 
// Пример:
// Если Не ТаблицаТоваровПоУмолчанию Тогда
//		
//		ТекстЗапроса = 
//		"ВЫБРАТЬ
//		|	Товары.НоменклатураКонтрагента КАК НоменклатураКонтрагента,
//		|	Товары.Номенклатура КАК Номенклатура,
//		|	Товары.Характеристика КАК Характеристика,
//		|	Товары.Упаковка КАК Упаковка
//		|ПОМЕСТИТЬ Товары
//		|ИЗ
//		|	&Товары КАК Товары
//		|ГДЕ
//		|	Товары.Номенклатура <> ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
//		|	И Товары.НоменклатураПартнера <> ЗНАЧЕНИЕ(Справочник.НоменклатураКонтрагентов.ПустаяСсылка)";
//		
//		ТекстЗапроса = ТекстЗапроса + ОбщегоНазначения.РазделительПакетаЗапросов();
//		
//	КонецЕсли;
//	
//	ТекстЗапроса = ТекстЗапроса +
//	... (текст подмены полей).
//
// Параметры:
//  ТекстЗапроса              - Строка - текст запроса
//  ТаблицаТоваровПоУмолчанию - Булево - признак использования таблицы товаров по умолчанию с колонками:
//   Номенклатура            - ОпределяемыйТип.НоменклатураБЭД               - ссылка номенклатуры.
//   Характеристика          - ОпределяемыйТип.ХарактеристикаНоменклатурыБЭД - ссылка характеристики.
//   Упаковка                - ОпределяемыйТип.УпаковкаНоменклатурыБЭД       - ссылка упаковки/единицы измерения.
//   НоменклатураКонтрагента - СправочникСсылка.НоменклатураКонтрагентов     - ссылка номенклатуры контрагента.
//
Процедура ТекстЗапросаПоискаНеСопоставленнойНоменклатурыКонтрагентовПоНоменклатуреИБ(ТекстЗапроса, ТаблицаТоваровПоУмолчанию) Экспорт

КонецПроцедуры

//++ Локализация

// Формирует и переопределяет таблицу сопоставления номенклатуры контрагентов в документах.
// Необходимо заполнить параметр ТаблицаСопоставления по набору документов.
//   ТаблицаСопоставления - должна вернуться таблица значений с типами колонок:
//    Владелец                             - ОпределяемыйТип.ВладелецНоменклатурыБЭД       - владелец номенклатуры контрагента.
//    СсылкаНаДокумент                     - ДокументСсылка                                - документ, участвующий в сопоставление номенклатуры БЭД.
//    НоменклатураКонтрагента              - СправочникСсылка.НоменклатураКонтрагентов     - ссылка номенклатуры контрагента.
//    НомерСтроки                          - Строка                                        - номер строки.
//    Номенклатура                         - ОпределяемыйТип.НоменклатураБЭД               - ссылка номенклатуры.
//    Характеристика                       - ОпределяемыйТип.ХарактеристикаНоменклатурыБЭД - ссылка характеристики.
//    Упаковка                             - ОпределяемыйТип.УпаковкаНоменклатурыБЭД       - ссылка упаковки. Если Номенклатура заполнена в документа, упаковка должна быть заполнена.
//                                                                                            Необходимо передавать упаковку или базовую единицу измерения номенклатуры.
//    НоменклатураПоиск                    - ОпределяемыйТип.НоменклатураБЭД               - ссылка номенклатуры, по которой необходимо искать номенклатуру контрагента.
//                                                                                            Может отличаться от номенклатуры в документе, например, когда в документа товар другого качества.
//    УпаковкаПоиск                        - ОпределяемыйТип.УпаковкаНоменклатурыБЭД      -  ссылка упаковки, по которой необходимо искать номенклатуру контрагента. 
//    ХарактеристикаПоиск                  - ОпределяемыйТип.ХарактеристикаНоменклатурыБЭД - ссылка характеристики, по которой необходимо искать номенклатуру контрагента.
//    ИмяТабличнойЧасти                    - Строка                                        - имя табличной части, где располагается колонка с типом Справочник НоменклатураКонтрагентов в документе. 
//                                                                                            Если колонка не используется необходимо передать пустую строку.
//    ИмяКолонкиНоменклатурыКонтрагента    - Строка                                        - имя колонки с типом Справочник НоменклатураКонтрагентов в документе.
//                                                                                            Если колонка не используется необходимо передать пустую строку.
//    ПредставлениеНоменклатурыКонтрагента - Строка                                        - представление колонки с типом Справочник НоменклатураКонтрагентов в документе,
//                                                                                            которое необходимо вывести пользователю.
//                                                                                            Если колонка не используется необходимо передать пустую строку.
// Если в табличной части товаров в документе нет колонки с типом справочник НоменклатураКонтрагентов:
//  - установить ОткрыватьФормуДляИзмененияСопоставления = Истина, чтобы в случае неоднозначного сопоставления или неверного вывелась форма
// для редактирования сопоставления. 
//  - описать логику получения номенклатуры контрагента для данных документа.
//
// Параметры:
//  НаборДокументов                         - ДокументСсылка, Массив из ДокументСсылка - документы,в которых необходимо проверить сопоставление номенклатуры контрагентов БЭД.
//  ТаблицаСопоставления                    - ТаблицаЗначений                          - переопределяемая таблица сопоставления номенклатуры контрагентов.
//  ОткрыватьФормуДляИзмененияСопоставления - Булево                                   - признак необходимости открыть форму для редактирования сопоставления 
//                                                                                       номенклатуры контрагента при наличии неоднозначного сопоставления 
//                                                                                       или неверного. По умолчанию установлено Истина.
//
Процедура СформироватьТаблицуСопоставленияНоменклатурыКонтрагентовВДокументах(
	Знач НаборДокументов, ТаблицаСопоставления, ОткрыватьФормуДляИзмененияСопоставления) Экспорт
	
КонецПроцедуры

// Переносит результат изменения сопоставления номенклатуры контрагентов в документы.
// Используется в документах, где не встроена колонка с типом справочник НоменклатураКонтрагентов.
//
// Параметры:
//  ТаблицаСопоставления - ТаблицаЗначений - содержит колонки:
//   * СсылкаНаДокумент        - ДокументСсылка                                - документ, участвующий в сопоставление номенклатуры БЭД.
//   * НоменклатураКонтрагента - СправочникСсылка.НоменклатураКонтрагентов     - ссылка номенклатуры контрагента.
//   * НомерСтроки             - Число                                         - номер строки в документе.
//   * Номенклатура            - ОпределяемыйТип.НоменклатураБЭД               - ссылка номенклатуры.
//   * Характеристика          - ОпределяемыйТип.ХарактеристикаНоменклатурыБЭД - ссылка характеристики.
//   * Упаковка                - ОпределяемыйТип.УпаковкаНоменклатурыБЭД       - ссылка упаковки.
//
Процедура ПеренестиИзмененияСопоставленияНоменклатурыКонтрагентовВДокументы(Знач ТаблицаСопоставления) Экспорт
	
КонецПроцедуры

// Выполняется при сохранении сопоставления номенклатуры контрагентов и номенклатуры информационной базы.
//
// Параметры:
//  НоменклатураКонтрагента - Структура из см. СопоставлениеНоменклатурыКонтрагентовКлиентСервер.НоваяНоменклатураКонтрагента        - данные номенклатуры контрагента.
//  НоменклатураИБ          - Структура из см. СопоставлениеНоменклатурыКонтрагентовКлиентСервер.НоваяНоменклатураИнформационнойБазы - данные номенклатуры информационной базы.
//  Отказ                   - Булево                                                                               - при выполнении операции произошла ошибка.
//  ТекстОшибки             - Строка                                                                               - текст ошибки для вывода пользователю.
//
Процедура ПриСохраненииСопоставленияНоменклатурыКонтрагентов(Знач НоменклатураКонтрагента, Знач НоменклатураИБ, Отказ = Ложь, ТекстОшибки = "") Экспорт
	
КонецПроцедуры

//-- Локализация

#КонецОбласти

//++ Локализация

#Область РаботаСЭлектроннымДокументом

// Переопределяет заполнение владельца номенклатуры контрагента из дерева ЭД.
//
// Параметры:
//  ДеревоРазбора - ДеревоЗначений - результат разбора электронного документа.
//  Владелец      - ОпределяемыйТип.ВладелецНоменклатурыБЭД - параметры записываемого объекта.
//
Процедура ЗаполнитьВладельцаНоменклатурыКонтрагентаИзДереваРазбора(Знач ДеревоРазбора, Владелец) Экспорт
	
КонецПроцедуры

// Выполняется при отражении в учете электронного документа, содержащего информацию для сопоставления номенклатуры.
// Позволяет определить необходимость сопоставления номенклатуры для указанного способа обработки электронных документов,
// а также отказаться от отражения в учете, если сопоставление не выполнено.
// Если в электронном документе не передана информация для сопоставления,
// то отражение в учете будет продолжено независимо от настроек.
//
// Параметры:
//  Документ  - Структура - данные электронного документа (только чтение):
//   * СпособОбработки             - Строка    - способ отражения в учете электронного документа. См. СписокОперацийВидаЭД.
//                                 - Структура - способ отражения в учете УПД (расширенный):
//                                    ** ПервичныйДокумент - Строка - способ отражения в учете первичного документа.
//                                    ** СчетФактура       - Строка - способ отражения в учете счет-фактуры.
//  Настройки - Структура - настройки сопоставления номенклатуры (для изменения):
//   * ОтражатьТолькоСопоставленные - Булево - признак разрешения отражать в учете только документы с сопоставленной номенклатурой. По умолчанию Истина.
//                                             Если в электронном документе не передана информация для сопоставления,
//                                             тогда отражение в учете будет продолжено независимо от настроек.
//
Процедура ПриОтраженииВУчетеЭлектронногоДокументаСНоменклатурой(Знач Документ, Настройки) Экспорт

	СпособОбработкиВходящегоЭД = ?(ТипЗнч(Документ.СпособОбработки) = Тип("Структура"),
		Документ.СпособОбработки.ПервичныйДокумент,
		Документ.СпособОбработки);
		
	// Для актов об оказании услуг и счетов-фактур полученных не требуется 
	// обязательное сопоставление номенклатуры перед отражением в учете.
	Если ВРег(СпособОбработкиВходящегоЭД) = ВРег("ПоступлениеУслуг")
			Или ВРег(СпособОбработкиВходящегоЭД) = ВРег("ПоступлениеДопРасходов")
			Или ВРег(СпособОбработкиВходящегоЭД) = ВРег("СчетФактураПолученный") Тогда
		Настройки.ОтражатьТолькоСопоставленные = Ложь;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область РаботаСоСловарем

// Переопределяет список слов исключений меньше 3 букв.
//
// Параметры:
//  НаборСловИсключений - Массив из Строка - список слов исключений.
//
Процедура СписокИсключенийСловМеньше3БуквДляСопоставленияБЭД(НаборСловИсключений) Экспорт
	
КонецПроцедуры

// Переопределяет список незначимых слов исключений.
//
// Параметры:
//  НаборСловИсключений - Массив из Строка - список слов исключений.
//
Процедура СписокИсключенийНезначимыхСловДляСопоставленияБЭД(НаборСловИсключений) Экспорт

КонецПроцедуры

// Переопределяет значение наименования номенклатуры или характеристики (если используется), используемое в механизме сопоставления номенклатуры.
//
// Параметры:
//  СсылкаНаОбъект       - ОпределяемыйТип.ДанныеСопоставленияБЭД - ссылка номенклатуры или характеристики.
//  ЗначениеНаименования - Строка                                 - значение наименования номенклатуры или характеристики сопоставления.
//
Процедура ЗначениеНаименованияДанныхСопоставленияНоменклатурыБЭД(Знач СсылкаНаОбъект, ЗначениеНаименования) Экспорт

	Если ТипЗнч(СсылкаНаОбъект) <> Тип("СправочникСсылка.Номенклатура") Тогда
		Возврат;
	КонецЕсли;
	
	ЗначениеНаименования = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(СсылкаНаОбъект, "НаименованиеПолное");

КонецПроцедуры

// Переопределяет значения наименований номенклатуры или характеристики (если используется), используемое в механизме сопоставления номенклатуры.
//
// Параметры:
//  НаборСсылокНаОбъекты             - Массив из ОпределяемыйТип.ДанныеСопоставленияБЭД - набор ссылок номенклатуры или характеристики.
//  СоответствиеЗначенийНаименований - Соответствие                                     - содержит:
//   * Ключ     - ОпределяемыйТип.ДанныеСопоставленияБЭД - ссылка номенклатуры или характеристики.
//   * Значение - Строка                                 - значение наименования номенклатуры или характеристики.
//
Процедура ЗначенияНаименованийДанныхСопоставленияНоменклатурыБЭД(Знач НаборСсылокНаОбъекты, СоответствиеЗначенийНаименований) Экспорт
	
	Если ТипЗнч(НаборСсылокНаОбъекты[0]) <> Тип("СправочникСсылка.Номенклатура") Тогда
		Возврат;
	КонецЕсли;
	
	СоответствиеЗначенийНаименований = ОбщегоНазначения.ЗначениеРеквизитаОбъектов(НаборСсылокНаОбъекты, "НаименованиеПолное");
	
КонецПроцедуры

// Переопределяет наименование объекта сопоставления номенклатуры БЭД: номенклатуры или характеристики, если используется.
//
// Параметры:
//  СсылкаНаОбъект          - ОпределяемыйТип.ДанныеСопоставленияБЭД - ссылка на номенклатуру или характеристику сопоставления.
//  НаименованиеТипаОбъекта - Строка                                 - содержит наименование типа объекта,
//                                                                     должно передаваться наименование: "Номенклатура" или "Характеристика".
//
Процедура ОпределитьНаименованиеТипаОбъектаСопоставленияНоменклатурыБЭД(Знач СсылкаНаОбъект, НаименованиеТипаОбъекта) Экспорт
	
	Если ТипЗнч(СсылкаНаОбъект) = Тип("СправочникСсылка.Номенклатура") Тогда
		НаименованиеТипаОбъекта = "Номенклатура";
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ПоискСопоставленияНоменклатурыСНоменклатуройИБ

// Переопределяет текст запроса поиска вариантов сопоставления по штрихкоду комбинации: номенклатура, характеристика, упаковка.
// Если в прикладном решении на один штрихкод могут быть привязаны разные комбинации, необходимо отбирать только те штрихкоды,
// у которых комбинация с единственным вариантом. Другие штрихкоды не используем.
// В тексте запроса требуется вернуть предопределенные поля.
// Необходимо учитывать права пользователей при получении данных информационной базы.
//
// Доступна временная таблица:
//  ТаблицаШтрихкодовКомбинации - содержит данные номенклатуры контрагента. Колонки:
//   ШтрихкодКомбинации - Строка - штрихкод комбинации: номенклатура, характеристика, упаковка.
//  Индексируемое поле: ШтрихкодКомбинации.
//
// Предопределенные поля:
//  ШтрихкодКомбинации - Строка                                        - штрихкод комбинации, по которому найдена единственная комбинация в ИБ.
//  НоменклатураИБ     - ОпределяемыйТип.НоменклатураБЭД               - ссылка номенклатуры ИБ сопоставленной по штрихкоду комбинации.
//  ХарактеристикаИБ   - ОпределяемыйТип.ХарактеристикаНоменклатурыБЭД - ссылка характеристики ИБ сопоставленной по штрихкоду комбинации.
//  УпаковкаИБ         - ОпределяемыйТип.УпаковкаНоменклатурыБЭД       - ссылка упаковки ИБ сопоставленной по штрихкоду комбинации.
//
// Параметры:
//  ТекстЗапроса - Строка - текст запроса по данным информационной базы.
//
Процедура ТекстЗапросаПоискаВариантовСопоставленияПоШтрихкодамКомбинаций(ТекстЗапроса) Экспорт

	ТекстЗапроса =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	Штрихкоды.Штрихкод КАК ШтрихкодКомбинации,
	|	Штрихкоды.Номенклатура КАК НоменклатураИБ,
	|	Штрихкоды.Номенклатура.ЕдиницаИзмерения КАК УпаковкаИБ,
	|	НЕОПРЕДЕЛЕНО КАК ХарактеристикаИБ
	|ИЗ
	|	ТаблицаШтрихкодовКомбинации КАК ТаблицаШтрихкодовКомбинации
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ШтрихкодыНоменклатуры КАК Штрихкоды
	|		ПО ТаблицаШтрихкодовКомбинации.ШтрихкодКомбинации = Штрихкоды.Штрихкод";
	
КонецПроцедуры

// Переопределяет текст запроса поиска сопоставления по натуральным ключам в информационной базе.
// В тексте запроса необходимо описать алгоритм поиска номенклатуры по натуральным ключам (штрихкодам, артикулам, наименованию),
// в результате которого должны быть сформированы временные таблицы с предопределенными полями.
// В тексте запроса требуется вернуть временную таблицу с предопределенными полями.
// Необходимо учитывать права пользователей при получении данных информационной базы.
//
// Передается временная таблица с доступными данными по номенклатуре контрагентов:
//  ТаблицаНатуральныхКлючей - ТаблицаЗначений из см. СопоставлениеНоменклатурыКонтрагентовСлужебный.НоваяТаблицаНатуральныхКлючей
// Индексируемые поля: штрихкод, артикул, наименование.
// При работе с временной таблицей необходимо отбирать штрихкоды и артикулы заполненной строкой.
//
// Временные таблицы и предопределенные поля:
//  ТаблицаСопоставленныхПоШтрихкодам - необходимо найти номенклатуру ИБ, к которой привязан штрихкод номенклатуры контрагента:
//   ИдентификаторНоменклатуры - Строка                          - хеш номенклатуры контрагента из ТаблицаНатуральныхКлючей.
//   Штрихкод                  - Строка                          - штрихкод номенклатуры контрагента из ТаблицаНатуральныхКлючей.
//   ЭтоВнутреннийШтрихкод     - Булево                          - признак внутреннего штрихкода из ТаблицаНатуральныхКлючей.
//   Номенклатура              - ОпределяемыйТип.НоменклатураБЭД - ссылка сопоставленной номенклатуры по штрихкоду номенклатуры контрагента и информационной базой.
//   ШтрихкодСопоставлен       - Булево                          - признак сопоставленного штрихкода.
//   ЭтоНашаНоменклатура       - Булево                          - признак нашей номенклатуры, иначе номенклатура контрагента - из ТаблицаНатуральныхКлючей.
//
//  ТаблицаСопоставленныхПоАртикулам - необходимо найти номенклатуру ИБ, к которой привязан артикул номенклатуры контрагента:
//   Артикул                   - Строка                          - артикул номенклатуры контрагента из ТаблицаНатуральныхКлючей.
//   ИдентификаторНоменклатуры - Строка                          - хеш номенклатуры контрагента из ТаблицаНатуральныхКлючей.
//   Номенклатура              - ОпределяемыйТип.НоменклатураБЭД - ссылка сопоставленной номенклатуры по артикулу номенклатуры контрагента и информационной базой.
//   АртикулСопоставлен        - Булево                          - признак сопоставленного артикула.
//   ЭтоНашаНоменклатура       - Булево                          - признак нашей номенклатуры, иначе номенклатура контрагента - из ТаблицаНатуральныхКлючей.
//
//  ТаблицаСопоставленныхПоНаименованию - необходимо найти номенклатуру ИБ по наименованию номенклатуры, которая с признаком ЭтоНашаНоменклатура = Истина:
//   Наименование              - Строка                          - наименование номенклатуры контрагента из ТаблицаНатуральныхКлючей.
//   ИдентификаторНоменклатуры - Строка                          - хеш номенклатуры контрагента из ТаблицаНатуральныхКлючей.
//   Номенклатура              - ОпределяемыйТип.НоменклатураБЭД - ссылка сопоставленной номенклатуры по наименованию (полному или краткому)
//                                                                   номенклатуры контрагента и информационной базой.
//   НаименованиеСопоставлено  - Булево                          - признак сопоставленного наименования.
//   ЭтоНашаНоменклатура       - Булево                          - признак нашей номенклатуры, иначе номенклатура контрагента - из ТаблицаНатуральныхКлючей.
//
// Если установлен параметр ПоискНашейНоменклатуры = Истина - необходимо вернуть таблицы: 
//  ТаблицаСопоставленныхПоШтрихкодам, ТаблицаСопоставленныхПоАртикулам, ТаблицаСопоставленныхПоНаименованию.
// Если установлен параметр ПоискНашейНоменклатуры = Ложь - необходимо вернуть таблицы:
//  ТаблицаСопоставленныхПоШтрихкодам, ТаблицаСопоставленныхПоАртикулам.
// Таблицы необходимо проиндексировать по полям: ИдентификаторНоменклатуры, Номенклатура.
//
// Параметры:
//  ТекстЗапроса           - Строка - текст запроса по данным информационной базы.
//
Процедура ИнициализацияТекстаЗапросаПоискаСопоставленияПоНатуральнымКлючам(ТекстЗапроса) Экспорт

	ТекстЗапроса =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	|	ТаблицаНатуральныхКлючей.ИдентификаторНоменклатуры КАК ИдентификаторНоменклатуры,
	|	ТаблицаНатуральныхКлючей.Штрихкод КАК Штрихкод,
	|	ТаблицаНатуральныхКлючей.ЭтоВнутреннийШтрихкод КАК ЭтоВнутреннийШтрихкод,
	|	ТаблицаНатуральныхКлючей.ЭтоНашаНоменклатура КАК ЭтоНашаНоменклатура,
	|	Штрихкоды.Номенклатура КАК Номенклатура,
	|	ИСТИНА КАК ШтрихкодСопоставлен
	|ПОМЕСТИТЬ ТаблицаСопоставленныхПоШтрихкодам
	|ИЗ
	|	РегистрСведений.ШтрихкодыНоменклатуры КАК Штрихкоды
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТаблицаНатуральныхКлючей КАК ТаблицаНатуральныхКлючей
	|		ПО Штрихкоды.Штрихкод = ТаблицаНатуральныхКлючей.Штрихкод
	|ГДЕ
	|	ТаблицаНатуральныхКлючей.Штрихкод <> """"
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ИдентификаторНоменклатуры,
	|	Номенклатура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	|	ТаблицаНатуральныхКлючей.Артикул КАК Артикул,
	|	ТаблицаНатуральныхКлючей.ИдентификаторНоменклатуры КАК ИдентификаторНоменклатуры,
	|	ТаблицаНатуральныхКлючей.ЭтоНашаНоменклатура КАК ЭтоНашаНоменклатура,
	|	НоменклатураКонтрагента.Ссылка КАК Номенклатура,
	|	ИСТИНА КАК АртикулСопоставлен
	|ПОМЕСТИТЬ ТаблицаСопоставленныхПоАртикулам
	|ИЗ
	|	ТаблицаНатуральныхКлючей КАК ТаблицаНатуральныхКлючей
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК НоменклатураКонтрагента
	|		ПО ТаблицаНатуральныхКлючей.Артикул = НоменклатураКонтрагента.Артикул
	|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаСопоставленныхПоШтрихкодам КАК ТаблицаСопоставленныхПоШтрихкодам
	|		ПО ТаблицаНатуральныхКлючей.ИдентификаторНоменклатуры = ТаблицаСопоставленныхПоШтрихкодам.ИдентификаторНоменклатуры
	|			И (НЕ ТаблицаСопоставленныхПоШтрихкодам.ЭтоВнутреннийШтрихкод)
	|ГДЕ
	|	ТаблицаНатуральныхКлючей.Артикул <> """"
	|	И ТаблицаСопоставленныхПоШтрихкодам.ИдентификаторНоменклатуры ЕСТЬ NULL
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ИдентификаторНоменклатуры,
	|	Номенклатура";
	
КонецПроцедуры

// Переопределяет текст запроса отбора сопоставленных характеристик по владельцу в информационной базе.
// Необходимо описать алгоритм отбора сопоставленных характеристик из таблицы "ВариантыСопоставленияПоСловарю" и таблицы "ТаблицаНоменклатуры"
// по владельцу (если владельцем характеристики является номенклатура).
// Таблицы необходимо связывать по полю "ИдентификаторХарактеристики" с полем "Идентификатор" и владельцу из поля "СсылкаНаОбъект" с полем "НоменклатураИБ".
// В тексте запроса требуется вернуть временную таблицу с предопределенными полями.
//
// Доступны временные таблицы:
//  ТаблицаНоменклатуры - содержит данные номенклатуры контрагента по сопоставленным номенклатурам ИБ. Колонки:
//   НоменклатураИБ              - ОпределяемыйТип.НоменклатураБЭД - ссылка сопоставленной номенклатуры ИБ.
//   ИдентификаторХарактеристики - Строка                          - идентификатор характеристики по данным номенклатуры контрагента.
//  Индексируемые поля: ИдентификаторХарактеристики, НоменклатураИБ.
//
//  ВариантыСопоставленияПоСловарю - содержит сопоставленные характеристики. Колонки для использования:
//   Идентификатор  - Строка                                        - идентификатор характеристики по данным номенклатуры контрагента.
//   СсылкаНаОбъект - ОпределяемыйТип.ХарактеристикаНоменклатурыБЭД - ссылка сопоставленной характеристики ИБ.
//  Индексируемые поля: Идентификатор, СсылкаНаОбъект.
//
// Временная таблица и предопределенные поля:
// ХарактеристикиПоВладельцу - необходимо отобрать сопоставленные характеристики по владельцу номенклатуры ИБ:
//  Идентификатор  - Строка                                        - идентификатор характеристики по данным контрагента.
//  СсылкаНаОбъект - ОпределяемыйТип.ХарактеристикаНоменклатурыБЭД - ссылка сопоставленной характеристики ИБ отобранной по владельцу номенклатуры.
//  НоменклатураИБ - ОпределяемыйТип.НоменклатураБЭД               - ссылка сопоставленной номенклатуры ИБ.
// Таблицы необходимо проиндексировать по полям: Идентификатор, СсылкаНаОбъект.
//
// Пример:
//      "ВЫБРАТЬ РАЗЛИЧНЫЕ
//      |	ВариантыСопоставленияПоСловарю.Идентификатор КАК Идентификатор,
//      |	ВариантыСопоставленияПоСловарю.СсылкаНаОбъект КАК СсылкаНаОбъект,
//      |	ТаблицаНоменклатуры.НоменклатураИБ КАК НоменклатураИБ
//      |ПОМЕСТИТЬ ХарактеристикиПоВладельцу
//      |ИЗ
//      |	ВариантыСопоставленияПоСловарю КАК ВариантыСопоставленияПоСловарю
//      |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТаблицаНоменклатуры КАК ТаблицаНоменклатуры
//      |		ПО ВариантыСопоставленияПоСловарю.Идентификатор = ТаблицаНоменклатуры.ИдентификаторХарактеристики
//      |			И ВариантыСопоставленияПоСловарю.СсылкаНаОбъект.Владелец = ТаблицаНоменклатуры.НоменклатураИБ
//      |
//      |ИНДЕКСИРОВАТЬ ПО
//      |	Идентификатор,
//      |	СсылкаНаОбъект".
//
// Параметры:
//  ТекстЗапроса - Строка - текст запроса по данным информационной базы.
//
Процедура ТекстЗапросаОтбораХарактеристикНоменклатурыБЭДПоВладельцу(ТекстЗапроса) Экспорт

КонецПроцедуры

// Переопределяет текст запроса поиска характеристики с нашей номенклатурой. 
//
// Параметры:
//  ТекстЗапроса - Строка - текст запроса по данным информационной базы.
//
Процедура ТекстЗапросаПоискаВариантовСопоставленияХарактеристикиСНашейНоменклатурой(ТекстЗапроса) Экспорт
	
КонецПроцедуры

// Переопределяет текст запроса проверки строк сопоставления, которым можно заполнить автоматически
// характеристику, проверив ее принадлежность к выбранной номенклатуре в строке сопоставления.
//
// Доступна временная таблица:
//  ТаблицаСопоставления - содержит данные сопоставления номенклатуры контрагента и ИБ. Колонки:
//   НоменклатураИБ - ОпределяемыйТип.НоменклатураБЭД - ссылка сопоставленной номенклатуры ИБ.
//   Идентификатор  - Строка                          - идентификатор строки сопоставления по данным номенклатуры контрагента.
//  Индексируемые поля: НоменклатураИБ, Идентификатор.
//
// В параметрах запроса доступен параметр "Характеристика", в котором передается ссылка характеристики.
//
// Предопределенное поле, которое необходимо вернуть:
//  Идентификатор - Строка - идентификатор строки сопоставления по данным номенклатуры контрагента.
//
// Параметры:
//  ТекстЗапроса - Строка - текст запроса по данным информационной базы.
//
Процедура ТекстЗапросаОтбораСтрокСопоставленияДляЗаполненияХарактеристик(ТекстЗапроса) Экспорт
	
КонецПроцедуры

// Переопределяет текст запроса поиска сопоставления по упаковкам/единицам измерения в информационной базе.
// Необходимо описать поиск упаковок/единиц измерения ИБ по наименованию упаковки, единицы измерения или коду единицы измерения
// по данным номенклатуры контрагента. 
// Необходимо учитывать права пользователей при получении данных из информационной базы.
//
// Рекомендации поиска:
//  Упаковки рекомендуется искать по полному наименованию (если используется), по наименованию и по наименованию и/или коду базовой единицы измерения,
//  отобрав упаковки по владельцу (если владельцем упаковки является номенклатура). 
//  Единицы измерения по классификатору ОКЕИ рекомендуется искать по коду единицы измерения и наименованию.
//
// Доступна временная таблица:
//  ТаблицаНоменклатуры - содержит данные номенклатуры контрагента по сопоставленным номенклатурам ИБ. Колонки:
//   НоменклатураИБ        - ОпределяемыйТип.НоменклатураБЭД - ссылка сопоставленной номенклатуры ИБ. Используется для связи с владельцем упаковки 
//                                                               (если владельцем упаковки является номенклатура).
//   ЕдиницаИзмеренияКод   - Строка                          - код единицы измерения по данным номенклатуры контрагента.
//                                                               Используется для поиска единицы измерения по классификатору ОКЕИ.
//   ЕдиницаИзмерения      - Строка                          - наименование единицы измерения по данным номенклатуры контрагента.
//                                                               Используется для поиска упаковки или единицы измерения.
//   ИдентификаторУпаковки - Строка                          - идентификатор упаковки по данным номенклатуры контрагента.
//                                                               Используется для связи сопоставленных данных.
//  Индексируемые поля: НоменклатураИБ, ЕдиницаИзмерения.
//
// Необходимо вернуть предопределенные поля:
//  НоменклатураИБ        - ОпределяемыйТип.НоменклатураБЭД         - ссылка сопоставленной номенклатуры ИБ.
//  ИдентификаторУпаковки - Строка                                  - идентификатор упаковки по данным номенклатуры контрагента.
//  УпаковкаИБ            - ОпределяемыйТип.УпаковкаНоменклатурыБЭД - найденная упаковка или единица измерения по данным номенклатуры контрагента.
//
// Параметры:
//  ТекстЗапроса - Строка - текст запроса по данным информационной базы.
//
Процедура ТекстЗапросаПоискаВариантовСопоставленияУпаковкиНоменклатурыБЭД(ТекстЗапроса) Экспорт

	ТекстЗапроса =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ЕдиницыИзмерения.Ссылка КАК УпаковкаИБ,
	|	ТаблицаНоменклатуры.ИдентификаторУпаковки КАК ИдентификаторУпаковки,
	|	ТаблицаНоменклатуры.НоменклатураИБ КАК НоменклатураИБ
	|ИЗ
	|	ТаблицаНоменклатуры КАК ТаблицаНоменклатуры
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлассификаторЕдиницИзмерения КАК ЕдиницыИзмерения
	|		ПО ТаблицаНоменклатуры.ЕдиницаИзмеренияКод = ЕдиницыИзмерения.Код
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	ЕдиницыИзмерения.Ссылка,
	|	ТаблицаНоменклатуры.ИдентификаторУпаковки,
	|	ТаблицаНоменклатуры.НоменклатураИБ
	|ИЗ
	|	ТаблицаНоменклатуры КАК ТаблицаНоменклатуры
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлассификаторЕдиницИзмерения КАК ЕдиницыИзмерения
	|		ПО ТаблицаНоменклатуры.ЕдиницаИзмерения = ЕдиницыИзмерения.НаименованиеПолное
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	ЕдиницыИзмерения.Ссылка,
	|	ТаблицаНоменклатуры.ИдентификаторУпаковки,
	|	ТаблицаНоменклатуры.НоменклатураИБ
	|ИЗ
	|	ТаблицаНоменклатуры КАК ТаблицаНоменклатуры
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлассификаторЕдиницИзмерения КАК ЕдиницыИзмерения
	|		ПО ТаблицаНоменклатуры.ЕдиницаИзмерения = ЕдиницыИзмерения.Наименование";
	
КонецПроцедуры

#КонецОбласти

//-- Локализация

#Область РаботаСДаннымиИБ

//++ Локализация

// Выполняется при поиске номенклатуры информационной базы по идентификатору.
// Если при формировании электронного документа для сопоставления номенклатуры заполняется идентификатор без использования
// автоматической генерации с помощью библиотеки, то в данном методе необходимо описать алгоритм обратного получения данных
// информационной базы из идентификатора.
//
// Параметры:
//  Идентификатор  - Строка - идентификатор, по которому нужно определить номенклатуру ИБ.
//  НоменклатураИБ - Структура - результаты поиска номенклатуры ИБ по идентификатору.
//                               См. СопоставлениеНоменклатурыКонтрагентовКлиентСервер.НоваяНоменклатураИнформационнойБазы.
Процедура ПриПоискеНоменклатурыПоИдентификатору(Знач Идентификатор, НоменклатураИБ) Экспорт
	
КонецПроцедуры

//-- Локализация

// Определяет владельца номенклатуры контрагента.
//
// Параметры:
//  Контрагент - ОпределяемыйТип.УчастникЭДО             - контрагент, для которого нужно определить владельца номенклатуры.
//  Владелец   - ОпределяемыйТип.ВладелецНоменклатурыБЭД - владелец номенклатуры (для изменения). По умолчанию равен параметру Контрагент.
//
Процедура ПриОпределенииВладельцаНоменклатурыКонтрагента(Знач Контрагент, Владелец) Экспорт
	
КонецПроцедуры

// Определяет свойства набора номенклатур информационной базы.
// Описание свойств в методе СопоставлениеНоменклатурыКонтрагентовКлиентСервер.НовыеСвойстваНоменклатурыИБ.
//
// Параметры:
//  НаборНоменклатуры - Массив из ОпределяемыйТип.НоменклатураБЭД - ссылки на номенклатуру ИБ, для которой требуется определить свойства.
//  СвойстваНоменклатурИБ - Соответствие - содержит:
//  * Ключ     - ОпределяемыйТип.НоменклатураБЭД - ссылка на номенклатуру ИБ.
//  * Значение - Структура                       - содержит свойства номенклатуры ИБ.
//                                                 См. СопоставлениеНоменклатурыКонтрагентовКлиентСервер.НовыеСвойстваНоменклатурыИБ.
//
Процедура ПриОпределенииСвойствНоменклатурыИнформационнойБазы(Знач НаборНоменклатуры, СвойстваНоменклатурИБ) Экспорт

	СвойстваНоменклатуры = СопоставлениеНоменклатурыКонтрагентовКлиентСервер.НовыеСвойстваНоменклатурыИБ();
	СвойстваНоменклатуры.ИспользоватьХарактеристики           = Ложь;
	СвойстваНоменклатуры.ИспользоватьУпаковки                 = Ложь;
	СвойстваНоменклатуры.ОбязательноеЗаполнениеХарактеристики = Ложь;
	
	Если ТипЗнч(НаборНоменклатуры) = Тип("Массив") Тогда
		Для Каждого Номенклатура Из НаборНоменклатуры Цикл
			СвойстваНоменклатурИБ.Вставить(Номенклатура, СвойстваНоменклатуры);
		КонецЦикла;
	ИначеЕсли ТипЗнч(НаборНоменклатуры) = Тип("СправочникСсылка.Номенклатура") Тогда
		СвойстваНоменклатурИБ.Вставить(НаборНоменклатуры, СвойстваНоменклатуры);
	КонецЕсли;
	
КонецПроцедуры

// Определяет заголовки форм и полей сопоставления номенклатуры, которые могут зависеть от прикладного решения и его настроек.
//
// Параметры:
//  Представления - Структура - набор представлений, которые можно переопределить:
//   * ВладелецНоменклатурыПредставлениеОбъекта    - Строка - представление поля владельца номенклатуры.
//                                                            По умолчанию берется из определяемого типа ВладелецНоменклатурыБЭД.
//   * НоменклатураПредставлениеОбъекта            - Строка - представление поля номенклатуры.
//                                                            По умолчанию берется из определяемого типа НоменклатураБЭД.
//   * ХарактеристикаПредставлениеОбъекта          - Строка - представление поля характеристики номенклатуры.
//                                                            По умолчанию берется из определяемого типа ХарактеристикаНоменклатурыБЭД.
//   * УпаковкаПредставлениеОбъекта                - Строка - представление поля упаковки номенклатуры.
//                                                            По умолчанию берется из определяемого типа УпаковкаНоменклатурыБЭД.
//   * НоменклатураКонтрагентаПредставлениеСписка  - Строка - представление списка номенклатуры контрагентов.
//                                                            По умолчанию "Номенклатура контрагентов".
//   * НоменклатураКонтрагентаПредставлениеОбъекта - Строка - представление объекта номенклатуры контрагентов.
//                                                            По умолчанию "Номенклатура контрагента".
//   * ВладелецНоменклатурыВРодительномПадеже      - Строка - представление поля владелец номенклатуры в родительном падеже.
//                                                            По умолчанию "Контрагента".
//
// Пример:
//  Представления.НоменклатураКонтрагентаПредставлениеСписка  = НСтр("ru = 'Номенклатура партнеров'");
//  Представления.НоменклатураКонтрагентаПредставлениеОбъекта = НСтр("ru = 'Номенклатура партнера'");
//  Представления.ВладелецНоменклатурыПредставлениеОбъекта    = НСтр("ru = 'Партнер'");
//  Представления.ВладелецНоменклатурыВРодительномПадеже      = НСтр("ru = 'Партнера'").
//
Процедура ПриОпределенииПредставленийСопоставленияНоменклатуры(Представления) Экспорт

КонецПроцедуры

// Определяет взаимосвязь между частями номенклатуры информационной базы.
// Устанавливает зависимость характеристик и упаковок от номенклатуры.
// Используется при заполнении свойства "СвязиПараметровВыбора" в элементах формы.
//
// Параметры:
//  СтруктураНоменклатуры - Структура - описание структуры номенклатуры информационной базы (для изменения):
//   * ИмяПараметраСвязиХарактеристики - Строка - имя параметра связи выбора характеристики по номенклатуре. По умолчанию "Отбор.Владелец".
//   * ИмяПараметраСвязиУпаковки - Строка - имя параметра связи выбора упаковки по номенклатуре. По умолчанию "Отбор.Владелец".
//
Процедура ПриОпределенииСтруктурыНоменклатурыИнформационнойБазы(СтруктураНоменклатуры) Экспорт

	СтруктураНоменклатуры.ИмяПараметраСвязиХарактеристики = "";
	СтруктураНоменклатуры.ИмяПараметраСвязиУпаковки       = "";
	
КонецПроцедуры

// Определяет штрихкод комбинации( номенклатура, характеристика, упаковка) и штрихкоды номенклатуры.
// Необходимо заполнить параметры Штрихкод и ДругиеШтрихкодыНоменклатуры найденными штрихкодами.
//
// Параметры:
//  НоменклатураИБ              - см. СопоставлениеНоменклатурыКонтрагентовКлиентСервер.НоваяНоменклатураИнформационнойБазы
//  Штрихкод                    - Строка           - штрихкод комбинации: номенклатура, характеристики, упаковки.
//  ДругиеШтрихкодыНоменклатуры - Массив из Строка - штрихкоды номенклатуры.
//
Процедура ПриОпределенииШтрихкодовНоменклатурыКонтрагента(Знач НоменклатураИБ, Штрихкод, ДругиеШтрихкодыНоменклатуры) Экспорт
	
КонецПроцедуры

#КонецОбласти

//++ Локализация

#Область ЗаполнениеФормНаОснованииНоменклатурыКонтрагентов

// Заполняет форму номенклатуру по данным контрагента.
//
// Параметры:
//  НоменклатураКонтрагента - Структура - данные контрагента для заполнения формы номенклатуры.
//                                        См. СопоставлениеНоменклатурыКонтрагентовКлиентСервер.НоваяНоменклатураКонтрагента.
//  Форма - ФормаКлиентскогоПриложения, Форма - форма номенклатуры, которую нужно заполнить.
//
Процедура ПриЗаполненииФормыНоменклатурыПоДаннымКонтрагента(Знач НоменклатураКонтрагента, Форма) Экспорт

	ОбменСКонтрагентамиБП.ПриЗаполненииФормыНоменклатурыПоДаннымКонтрагента(НоменклатураКонтрагента, Форма);
	
КонецПроцедуры

// Заполняет форму характеристики по данным контрагента.
//
// Параметры:
//  НоменклатураКонтрагента - Структура - данные контрагента для заполнения формы характеристики.
//                                        См. СопоставлениеНоменклатурыКонтрагентовКлиентСервер.НоваяНоменклатураКонтрагента.
//  Форма - ФормаКлиентскогоПриложения - форма характеристики, которую нужно заполнить.
//
Процедура ПриЗаполненииФормыХарактеристикиПоДаннымКонтрагента(Знач НоменклатураКонтрагента, Форма) Экспорт
	
КонецПроцедуры

#КонецОбласти

//-- Локализация

#Область УправлениеДоступом

// См. УправлениеДоступомПереопределяемый.ПриЗаполненииОграниченияДоступа
Процедура ПриЗаполненииОграниченияДоступа_НоменклатураКонтрагентов(Ограничение) Экспорт
	
КонецПроцедуры

// См. УправлениеДоступомПереопределяемый.ПриЗаполненииСписковСОграничениемДоступа
Процедура ПриЗаполненииСписковСОграничениемДоступа_НоменклатураКонтрагентов(Списки) Экспорт
	
КонецПроцедуры

// См. УправлениеДоступомПереопределяемый.ПриЗаполненииВидовОграниченийПравОбъектовМетаданных
Процедура ПриЗаполненииВидовОграниченийПравОбъектовМетаданных_НоменклатураКонтрагентов(Описание) Экспорт
	
КонецПроцедуры

#КонецОбласти

#Область ВерсионированияОбъектов

// Определяет настройки объекта для подсистемы ВерсионированиеОбъектов.
//
// Параметры:
//  Настройки - Структура - настройки подсистемы.
//
Процедура ПриОпределенииНастроекВерсионированияОбъектов_НоменклатураКонтрагентов(Настройки) Экспорт
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти
