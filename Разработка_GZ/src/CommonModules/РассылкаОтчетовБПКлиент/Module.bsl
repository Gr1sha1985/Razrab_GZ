
#Область СлужебныйПрограммныйИнтерфейс

// Обработчик команды формы отчета.
//
// Параметры:
//   Форма     - ФормаКлиентскогоПриложения - Форма отчета.
//   Команда   - КомандаФормы     - Команда, которая была вызвана.
//
// Места использования:
//   ОбщаяФорма.ФормаОтчета.Подключаемый_Команда().
//
Процедура НастроитьРассылкуИзОтчета(Форма) Экспорт
	
	НастройкиОтчета = Форма.НастройкиОтчета;
	РежимВариантаОтчета = (ТипЗнч(Форма.КлючТекущегоВарианта) = Тип("Строка") И Не ПустаяСтрока(Форма.КлючТекущегоВарианта));
	
	СтрокаОтчетыПараметры = Новый Структура("ОтчетПолноеИмя, КлючВарианта, ВариантСсылка, Настройки, АдресНастроекОтчета");
	СтрокаОтчетыПараметры.ОтчетПолноеИмя = НастройкиОтчета.ПолноеИмя;
	СтрокаОтчетыПараметры.КлючВарианта   = Форма.КлючТекущегоВарианта;
	СтрокаОтчетыПараметры.ВариантСсылка  = НастройкиОтчета.ВариантСсылка;
	Если РежимВариантаОтчета Тогда
		СтрокаОтчетыПараметры.Настройки = Форма.Отчет.КомпоновщикНастроек.ПользовательскиеНастройки;
		СтрокаОтчетыПараметры.АдресНастроекОтчета = НастройкиОтчета.АдресНастроекОтчета;
	КонецЕсли;
	
	ПрисоединяемыеОтчеты = Новый Массив;
	ПрисоединяемыеОтчеты.Добавить(СтрокаОтчетыПараметры);
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("ПрисоединяемыеОтчеты", ПрисоединяемыеОтчеты);
	ПараметрыФормы.Вставить("ТабличныйДокумент", Форма.Результат);
	
	Если НастройкиОтчета.Свойство("РассылкаОтчетаСсылка") И ЗначениеЗаполнено(НастройкиОтчета.РассылкаОтчетаСсылка) Тогда
		ПараметрыФормы.Вставить("Ключ", НастройкиОтчета.РассылкаОтчетаСсылка);
	КонецЕсли;
	
	Если НастройкиОтчета.Свойство("ВариантРасписания") Тогда
		ПараметрыФормы.Вставить("ВариантРасписания", НастройкиОтчета.ВариантРасписания);
	КонецЕсли;
	
	ОткрытьФорму(
		"Справочник.РассылкиОтчетов.Форма.НастройкаРассылкиБП",
		ПараметрыФормы,
		Форма,
		Строка(Форма.УникальныйИдентификатор) + ".ОткрытьРассылкуОтчетов");
	
КонецПроцедуры

#КонецОбласти
